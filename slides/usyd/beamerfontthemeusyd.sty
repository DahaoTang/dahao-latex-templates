\ProvidesPackage{beamerfontthemeusyd}[2025/12/15 USYD font theme (Tw Cen MT / Tinos / GoogleSansCode)]

%========================================================
% Engine guard: this theme is XeLaTeX-only
%========================================================
\RequirePackage{iftex}
\ifXeTeX\else
  \PackageError{beamerfontthemeusyd}{This theme requires XeLaTeX}{Use xelatex.}
\fi

%========================================================
% Core font loader
%========================================================
\RequirePackage{fontspec}
\defaultfontfeatures{Ligatures=TeX}

%========================================================
% Font file location (relative to slides.tex)
%========================================================
\newcommand*\USYDFontPath{./fonts/}

%========================================================
% Text fonts: Tw Cen MT
% - Only one font file is provided, so we use FakeBold/FakeSlant.
% - Load by filename to avoid dependency on system-installed fonts.
%========================================================
\setmainfont[
  Path=\USYDFontPath,
  Extension=.ttf,
  UprightFont=Tw-Cen-MT,
  BoldFont=Tw-Cen-MT,
  ItalicFont=Tw-Cen-MT,
  BoldItalicFont=Tw-Cen-MT,
  BoldFeatures={FakeBold=2.0},
  ItalicFeatures={FakeSlant=0.20},
  BoldItalicFeatures={FakeBold=2.0,FakeSlant=0.20}
]{Tw-Cen-MT}

% Beamer often uses sans for body; here we deliberately keep sans aligned to Tw Cen MT.
\setsansfont[
  Path=\USYDFontPath,
  Extension=.ttf,
  UprightFont=Tw-Cen-MT,
  BoldFont=Tw-Cen-MT,
  ItalicFont=Tw-Cen-MT,
  BoldItalicFont=Tw-Cen-MT,
  BoldFeatures={FakeBold=2.0},
  ItalicFeatures={FakeSlant=0.20},
  BoldItalicFeatures={FakeBold=2.0,FakeSlant=0.20}
]{Tw-Cen-MT}

%========================================================
% Code font: GoogleSansCode (full family provided)
%========================================================
\setmonofont[
  Path=\USYDFontPath,
  Extension=.ttf,
  UprightFont=GoogleSansCode-Regular,
  ItalicFont=GoogleSansCode-Italic,
  BoldFont=GoogleSansCode-Bold,
  BoldItalicFont=GoogleSansCode-BoldItalic
]{GoogleSansCode-Regular}

%========================================================
% Math font strategy (NO unicode-math)
% - Standard TeX math symbols remain unchanged.
% - Latin math alphabets are forced to Tinos for consistency/readability.
%========================================================
\RequirePackage{amsmath}
\RequirePackage{amssymb}

% Load Tinos as an NFSS family via fontspec.
\newfontfamily\USYDTinos[
  Path=\USYDFontPath,
  Extension=.ttf,
  UprightFont=Tinos-Regular,
  ItalicFont=Tinos-Italic,
  BoldFont=Tinos-Bold,
  BoldItalicFont=Tinos-BoldItalic
]{Tinos-Regular}

% Internal storage for NFSS family names (captured at begin document)
\newcommand*\USYD@TinosFamily{}
\newcommand*\USYD@MonoFamily{}

\AtBeginDocument{%
  %------------------------------------------------------
  % Capture NFSS family names from fontspec-defined fonts
  %------------------------------------------------------
  \begingroup\USYDTinos\global\edef\USYD@TinosFamily{\f@family}\endgroup
  \begingroup\ttfamily \global\edef\USYD@MonoFamily {\f@family}\endgroup

  %------------------------------------------------------
  % Math alphabets: map the main math alphabet commands to Tinos
  % Notes:
  % - This affects Latin letters/digits as provided by these alphabets.
  % - TeX math symbols (operators, relations, etc.) are unchanged.
  %------------------------------------------------------

  % Default math letters (\mathnormal): italic Tinos
  \DeclareMathAlphabet{\mathnormal}{TU}{\USYD@TinosFamily}{m}{it}
  \SetMathAlphabet{\mathnormal}{bold}{TU}{\USYD@TinosFamily}{b}{it}

  % Upright roman in math (\mathrm): upright Tinos
  \DeclareMathAlphabet{\mathrm}{TU}{\USYD@TinosFamily}{m}{n}
  \SetMathAlphabet{\mathrm}{bold}{TU}{\USYD@TinosFamily}{b}{n}

  % Bold upright in math (\mathbf): bold upright Tinos
  \DeclareMathAlphabet{\mathbf}{TU}{\USYD@TinosFamily}{b}{n}

  % Italic in math (\mathit): italic Tinos
  \DeclareMathAlphabet{\mathit}{TU}{\USYD@TinosFamily}{m}{it}
  \SetMathAlphabet{\mathit}{bold}{TU}{\USYD@TinosFamily}{b}{it}

  % Sans in math (\mathsf): keep consistent with "Tinos for math"
  \DeclareMathAlphabet{\mathsf}{TU}{\USYD@TinosFamily}{m}{n}
  \SetMathAlphabet{\mathsf}{bold}{TU}{\USYD@TinosFamily}{b}{n}

  % Typewriter in math (\mathtt): use the monofont family
  \DeclareMathAlphabet{\mathtt}{TU}{\USYD@MonoFamily}{m}{n}
  \SetMathAlphabet{\mathtt}{bold}{TU}{\USYD@MonoFamily}{b}{n}
}

%========================================================
% \text{...} inside math:
% - Ensure it uses Tinos.
% - Outside math, preserve amsmath's \text behaviour.
%========================================================
\let\USYD@origtext\text
\renewcommand{\text}[1]{%
  \ifmmode
    \hbox{\USYDTinos #1}%
  \else
    \USYD@origtext{#1}%
  \fi
}

%========================================================
% Beamer font selections
%========================================================
\setbeamerfont{title}{family=\rmfamily,series=\bfseries,size=\LARGE}
\setbeamerfont{subtitle}{family=\rmfamily,series=\bfseries,size=\Large}
\setbeamerfont{frametitle}{family=\rmfamily,series=\bfseries,size=\Large}

% Global defaults for body/structure text
\setbeamerfont{normal text}{family=\rmfamily}
\setbeamerfont{structure}{family=\rmfamily}

% Secondary elements
\setbeamerfont{author}{size=\normalsize}
\setbeamerfont{date}{size=\normalsize}
\setbeamerfont{block title}{size=\normalsize}
\setbeamerfont{block body}{size=\small}
\setbeamerfont{footline}{size=\scriptsize}
