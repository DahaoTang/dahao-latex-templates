\ProvidesPackage{beamerfontthemeusyd}[USYD font theme]

%========================================================
% Engine Check (XeLaTeX required)
%========================================================
\RequirePackage{iftex}
\ifXeTeX\else
  \PackageError{beamerfontthemeusyd}{This theme requires XeLaTeX}{Use xelatex.}
\fi

%========================================================
% Font Configuration
%========================================================
\RequirePackage{fontspec}
\RequirePackage{amsmath}
\RequirePackage{amssymb}

\defaultfontfeatures{Ligatures=TeX}
\newcommand*\USYDFontPath{./fonts/}

%--------------------------------------------------------
% Main Fonts (Tw Cen MT)
%--------------------------------------------------------
\setmainfont{Tw-Cen-MT}[
  Path=\USYDFontPath, Extension=.ttf,
  UprightFont=Tw-Cen-MT,
  BoldFont=Tw-Cen-MT,
  ItalicFont=Tw-Cen-MT,
  BoldItalicFont=Tw-Cen-MT,
  BoldFeatures={FakeBold=2.0},
  ItalicFeatures={FakeSlant=0.20},
  BoldItalicFeatures={FakeBold=2.0,FakeSlant=0.20}
]

\setsansfont{Tw-Cen-MT}[
  Path=\USYDFontPath, Extension=.ttf,
  UprightFont=Tw-Cen-MT,
  BoldFont=Tw-Cen-MT,
  ItalicFont=Tw-Cen-MT,
  BoldItalicFont=Tw-Cen-MT,
  BoldFeatures={FakeBold=2.0},
  ItalicFeatures={FakeSlant=0.20},
  BoldItalicFeatures={FakeBold=2.0,FakeSlant=0.20}
]

%--------------------------------------------------------
% Monospace Font (Google Sans Code)
%--------------------------------------------------------
\setmonofont{GoogleSansCode-Regular}[
  Path=\USYDFontPath, Extension=.ttf,
  UprightFont=GoogleSansCode-Regular,
  ItalicFont=GoogleSansCode-Italic,
  BoldFont=GoogleSansCode-Bold,
  BoldItalicFont=GoogleSansCode-BoldItalic
]

%--------------------------------------------------------
% Math Fonts (Tinos for Latin alphabets)
%--------------------------------------------------------
\newfontfamily\USYDTinos{Tinos-Regular}[
  Path=\USYDFontPath, Extension=.ttf,
  UprightFont=Tinos-Regular,
  ItalicFont=Tinos-Italic,
  BoldFont=Tinos-Bold,
  BoldItalicFont=Tinos-BoldItalic
]

% Capture NFSS family names
\newcommand*\USYD@TinosFamily{}
\newcommand*\USYD@MonoFamily{}

\AtBeginDocument{%
  \begingroup\USYDTinos\global\edef\USYD@TinosFamily{\f@family}\endgroup
  \begingroup\ttfamily \global\edef\USYD@MonoFamily {\f@family}\endgroup

  % Map standard math alphabets to Tinos or Monospace
  \DeclareMathAlphabet{\mathnormal}{TU}{\USYD@TinosFamily}{m}{it}
  \SetMathAlphabet{\mathnormal}{bold}{TU}{\USYD@TinosFamily}{b}{it}
  
  \DeclareMathAlphabet{\mathrm}{TU}{\USYD@TinosFamily}{m}{n}
  \SetMathAlphabet{\mathrm}{bold}{TU}{\USYD@TinosFamily}{b}{n}
  
  \DeclareMathAlphabet{\mathbf}{TU}{\USYD@TinosFamily}{b}{n}
  
  \DeclareMathAlphabet{\mathit}{TU}{\USYD@TinosFamily}{m}{it}
  \SetMathAlphabet{\mathit}{bold}{TU}{\USYD@TinosFamily}{b}{it}
  
  \DeclareMathAlphabet{\mathsf}{TU}{\USYD@TinosFamily}{m}{n}
  \SetMathAlphabet{\mathsf}{bold}{TU}{\USYD@TinosFamily}{b}{n}
  
  \DeclareMathAlphabet{\mathtt}{TU}{\USYD@MonoFamily}{m}{n}
  \SetMathAlphabet{\mathtt}{bold}{TU}{\USYD@MonoFamily}{b}{n}
}

% Fix \text{} inside math mode to use Tinos
\let\USYD@origtext\text
\renewcommand{\text}[1]{%
  \ifmmode\hbox{\USYDTinos #1}\else\USYD@origtext{#1}\fi
}

%========================================================
% Beamer Element Settings
%========================================================
\setbeamerfont{title}     {family=\rmfamily, series=\bfseries, size=\LARGE}
\setbeamerfont{subtitle}  {family=\rmfamily, series=\bfseries, size=\Large}
\setbeamerfont{frametitle}{family=\rmfamily, series=\bfseries, size=\Large}

\setbeamerfont{normal text}{family=\rmfamily}
\setbeamerfont{structure}  {family=\rmfamily}

\setbeamerfont{author}     {size=\normalsize}
\setbeamerfont{date}       {size=\normalsize}
\setbeamerfont{block title}{size=\normalsize}
\setbeamerfont{block body} {size=\small}
\setbeamerfont{footline}   {size=\scriptsize}