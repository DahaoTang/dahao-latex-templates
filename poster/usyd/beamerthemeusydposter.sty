\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{beamerthemeusydposter}[University of Sydney Beamer Poster Theme]

%==============================================================================
%                               MODE: PRESENTATION
%==============================================================================
\mode<presentation>

%==============================================================================
%                                 DEPENDENCIES
%==============================================================================
\RequirePackage{graphicx}   % Image handling
\RequirePackage{etoolbox}   % Conditional logic
\RequirePackage{tcolorbox}  % Advanced block styling
\tcbuselibrary{raster,skins}

%==============================================================================
%                           ASSETS AND CONFIGURATION
%==============================================================================

% --- Path Configuration ---
% Look in local assets first, then shared style assets
\graphicspath{{assets/}{../../style/usyd/assets/}}

% --- Internal Variables (Defaults) ---
\gdef\USYD@logo{USYDLogo}
\gdef\USYD@affiliationlogo{}

% Default content for the header corners
\gdef\USYD@poster@logoleftcontent{%
  \ifdefempty{\USYD@affiliationlogo}{}{%
    \includegraphics[height=8cm]{\USYD@affiliationlogo}%
  }%
}
\gdef\USYD@poster@logorightcontent{%
  \includegraphics[height=8cm]{\USYD@logo}%
}

% --- Public API (User Commands) ---
% Sets the main logo and updates the right header slot
\def\logo#1{%
  \gdef\USYD@logo{#1}%
  \logoright{\includegraphics[height=8cm]{#1}}%
}

% Sets the affiliation logo and updates the left header slot
\def\affiliationlogo#1{%
  \gdef\USYD@affiliationlogo{#1}%
  \logoleft{\includegraphics[height=8cm]{#1}}%
}

% Direct overrides for header slots (flexibility for custom text/images)
\def\logoleft#1{\gdef\USYD@poster@logoleftcontent{#1}}
\def\logoright#1{\gdef\USYD@poster@logorightcontent{#1}}

%==============================================================================
%                             THEME IMPORT
%==============================================================================
\RequirePackage{../../style/usyd/beamerfontthemeusyd}
\RequirePackage{../../style/usyd/beamercolorthemeusyd}

%==============================================================================
%                             GENERAL SETTINGS
%==============================================================================

% --- Navigation & Bibliography ---
\setbeamertemplate{navigation symbols}{}
\setbeamertemplate{bibliography item}{\insertbiblabel}

% --- Spacing Defaults ---
\setlength{\parskip}{0.35em}
\setlength{\parindent}{0pt}

%==============================================================================
%                             BLOCK STYLING
%==============================================================================
\tcbset{
  usydblock/.style={
    enhanced,
    sharp corners,
    colback=usydwhite,
    colframe=usydred,
    boxsep=0.6em,
    boxrule=0.8pt,
    left=0.8em,
    right=0.8em,
    top=0.7em,
    bottom=0.7em,
    fonttitle=\bfseries,
    title={#1},
  }
}

\setbeamertemplate{block begin}{%
  \begin{tcolorbox}[usydblock={\insertblocktitle}]%
}
\setbeamertemplate{block end}{%
  \end{tcolorbox}\vspace{0.9em}%
}

%==============================================================================
%                           TEMPLATE: HEADLINE
%==============================================================================
\setbeamertemplate{headline}{
  \vbox{%
    \begin{beamercolorbox}[wd=\paperwidth, sep=1cm]{headline}
      \begin{columns}[c]
        
        % 1. Left Slot
        \begin{column}{0.2\paperwidth}
          \centering
          \USYD@poster@logoleftcontent
        \end{column}

        % 2. Center Slot
        \begin{column}{0.6\paperwidth}
          \centering
          \usebeamercolor{title in headline}
          {\bfseries \Huge \inserttitle\par}
          \vspace{1em}
          {\Large \insertauthor\par}
          {\large \insertinstitute\par}
        \end{column}

        % 3. Right Slot
        \begin{column}{0.2\paperwidth}
          \centering
          \USYD@poster@logorightcontent
        \end{column}

      \end{columns}
    \end{beamercolorbox}%
    \nointerlineskip%
    \begin{beamercolorbox}[wd=\paperwidth, ht=0cm]{lower separation line head}
    \end{beamercolorbox}%
  }%
}

%==============================================================================
%                           TEMPLATE: FOOTLINE (Default)
%==============================================================================
% This is the default footer. Your poster.tex overrides this with custom info.
\setbeamertemplate{footline}{%
  \leavevmode%
  % \begin{beamercolorbox}[wd=\paperwidth]{upper separation line foot}
  %   \rule{0pt}{3pt}%
  % \end{beamercolorbox}%
  % \nointerlineskip%
  \begin{beamercolorbox}[ht=3.5ex, leftskip=1.5em, rightskip=1.5em]{author in head/foot}%
    \hfill\vskip1ex%
  \end{beamercolorbox}%
}

\mode<all>